<!DOCTYPE html>
<html>

<head>
  <base target="_top">
    <!--<meta http-equiv="Content-Security-Policy" content="default-src none; script-src manicotti.se.rit.edu ajax.googleapis.com">-->
    <!--<meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' ssl.gstatic.com 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' ajax.googleapis.com  manicotti.se.rit.edu">-->
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  <!-- The CSS package above applies Google styling to buttons and other elements. -->

  <style>
    .branding-below {
      bottom: 0px;
      top: 0;
    }

    .branding-text {
      left: 7px;
      position: relative;
      top: 3px;
    }

    .col-contain {
      overflow: hidden;
    }

    .col-one {
      float: left;
      width: 50%;
    }

    .logo {
      vertical-align: middle;
      vertical-align: middle;
    }

    .radio-spacer {
      height: 20px;
    }

    .width-100 {
      width: 100%;
    }

    .recommendationCard {
        opacity: 0.8;
        background: #1464f6;
        border-radius: 15px;
        padding: 15px;
        text-align:left;
        overflow: hidden;
        margin-top: 5px;
    }

    .recommendationCard:hover {
        opacity: 1;
        box-shadow: 0 0 8px grey;
        transition-duration: 150ms;
        transition-property: box-shadow;
    }

    .pargraphLabel{
      margin-top: 5px;
      font: 15px arial;
    }

    .recHeader{
        text-align: center;
    }

    .recHeaderText{
        text-align:left;
        color: white;
        float:left;
        font: 20px arial;
        width: 70%;

    }

    .recIconThumb{
        float:right;
        width:20px;
        height:20px;
        margin-right: 2px;
    }

    .recIconThumb:hover{
      width:22px;
      height:22px;
    }

    .recText{
        color: white;
        float: left;
        font: 12px arial;
        padding-top: 5px;
    }

    .recSubTitle{
        font-style: italic;
    }


    #analyzeBtn {
      background: #616161;
      border-radius: 15px;
      padding: 10px;
      text-align:center;
      overflow: hidden;
      margin-top: 5px;
      font: 20px arial;
      color: white;
    }

    #refreshPng{
      height: 15px;
      width: 15px;
      filter: invert(100);
      animation: spin 10s linear infinite;
    }

    #recommendations{
      height:90%;
      overflow: scroll;
    }


  </style>
</head>

<body>
  <div class="sidebar branding-below">
    <div id="recommendations">
      <!--Recommendation cards load here -->
    </div>
    <div id="analyzeBtn">
      Analyze
      <img id="refreshPng" src="https://img.icons8.com/windows/32/000000/refresh.png">
    </div>
  </div>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
    /**
     * On document load, assign click handlers to each button and try to load the
     * user's origin and destination language preferences if previously set.
     */
    $(function () {
      $('#rescanBtn').click(scanDocument);
      scanDocument();
    });

    $('#analyzeBtn').click(function () {
        console.log("Analyzing");
        scanDocument();
    });

    $('#recommendations').on('click', '.thumbs_up', function() {
        //Get UID
        //Call implement_recommendation(UID) in gs file
        //Tell the server not to show that card any more
        //Delete card

        google.script.run
            .withSuccessHandler(function () {

            })
            .withFailureHandler(

            )
            .ThumbsUp(this.id);
        $("#" + this.id + ".recommendationCard").remove()

    });

    $('#recommendations').on('click', '.thumbs_down', function() {
        //Get UID
        //ajax to API that the user hid that card(UID)
        //Delete card
        google.script.run
            .withSuccessHandler(function (html) {

            })
            .withFailureHandler(

            )
            .ThumbsDown(this.id);

        $("#" + this.id + ".recommendationCard").remove();
    });


    /**
     * Request the server to scan the opened document.
     */ 
    function scanDocument() {
      $("#resultsDiv").hide();
      $('#rescanBtnDiv').hide();
      $('#systemErrorDiv').hide();
      $('#simpleToComplexErrorsDiv').hide();
      $('#noErrorsDiv').hide();
      $('#errorsFoundMsg').hide();
      $('#simpleToComplexErrorListDiv').empty();
      $('#passiveHardReccListDiv').empty();
      $('#passiveHardReccDiv').hide();
      $('#passiveSoftReccListDiv').empty();
      $('#passiveSoftReccDiv').hide();
      $('#refreshPng').show();

      google.script.run
            .withSuccessHandler(function (html) {
                //scanDocument returns structured html, no just put it in the correct div
                $('#recommendations').html(html);
                $('#refreshPng').hide();
            })
            .withFailureHandler(
                function (reason) {
                    console.log("Failed to scan document because: " + reason);
                    $('#refreshPng').hide();
                    $('#systemErrorDiv').show();
                    $('#rescanBtnDov').show();
                }
            )
            .scanDocument();
    }








    /**
     * Renders the suggestions returned from the server for the user.
     */
    function renderResults(results) {
      return "";
    if (results.totalSuggestions === 0) {
      $('#noErrorsDiv').show();
    } else {
      var errorsText = results.totalSuggestions === 1 ? 'One suggestion found' : results.totalSuggestions + ' suggestions found.';
      $('#errorsFoundMsg').text(errorsText);
      console.log(results);


      if (results.simpleToComplex.length > 0) {
        for (let result of results.simpleToComplex) {
          // let beforeError = result.elementText.substring(0, result.startOffset);
          let errorText = result.elementText.substring(
            result.startOffset,
            result.endOffset + 1);
          // let afterError = result.elementText.substring(result.endOffset + 1);
          let $resultNode = $("<li></li>").text(errorText);

          // let $correctButton = $("<button></button").text('Correct');
          // $correctButton.data({
          //   paragraphNum: result.paragraphNum,
          //   startOffset: result.startOffset, 
          //   endOffset: result.endOffset,
          //   replaceText: 'cried'
          // });
          // $correctButton.click(correctError);
          // $resultNode.append($correctButton);
          // $correctButton.css('display', 'inline');

          $('#simpleToComplexErrorListDiv').append($resultNode);
        }
      }

      if (results.passiveVoice.length > 0) {
        for (let result of results.passiveVoice) {
          $resultNode = $("<li></li>").text(result.Sentence);

          if(result.HardRecc.length > 0) {
            $('#passiveHardReccListDiv').append($resultNode);

          } else {
            $('#passiveSoftReccListDiv').append($resultNode);
          }
        }
      }
    }
    $('#scanningMsgDiv').hide();
    $('#resultsDiv').show();
    $('#rescanBtnDiv').show();

    if ($('#simpleToComplexErrorListDiv').children().length > 0) {
      $('#simpleToComplexErrorsDiv').show();
    }

    if ($('#passiveHardReccListDiv').children().length > 0) {
      $('#passiveHardReccDiv').show();
    }

    if ($('#passiveSoftReccListDiv').children().length > 0) {
      $('#passiveSoftReccDiv').show();
    }
  }

  /**
   * Requests the selected suggestion to be made to the document.
   * @param suggestionButton the 'Correct' button for a given suggestion
   */
  function correctError (suggestionButton) {
      var buttonPressed = $(suggestionButton.target);

      buttonPressed.prop('disabled', true);
      buttonPressed.text('Correcting...');

      google.script.run
      .withSuccessHandler(
        function () {
          buttonPressed.text('Corrected');
        })
      .correctError(buttonPressed.data());
  }
</script>


</html>